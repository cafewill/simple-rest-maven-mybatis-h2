<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cube.simple.mapper.read.ReadItemMapper">

    <select id="selectAll" resultType="Item">
		SELECT
			* 
		FROM Item
	    <where>
			<if test="category != null and category != ''">
		        AND category = #{category}
			</if>
			<if test="search != null and search != ''">
	 			AND (
					name        LIKE CONCAT('%', #{search}, '%')
					OR description LIKE CONCAT('%', #{search}, '%')
	 			)
			</if>
		</where>
		<bind name="offset" value="(page - 1) * size"/>
		LIMIT #{size} OFFSET #{offset}
    </select>

    <select id="selectById" resultType="Item">
		SELECT
			* 
		FROM Item
		WHERE id = #{id}
    </select>

    <select id="selectCount" resultType="Long">
		SELECT
			COUNT(id) as n 
		FROM Item
    </select>

</mapper>